#!/usr/bin/env node

'use strict';

var program = require('commander');
var Map = require('../lib/Map');

var map;
var coordinate;
var coordinates;
var projectedPoint;
var projectedPoints;
var coordinateZooms;
var pixel;
var pixelZooms;

program
  .version('0.0.4')
  .option('-e, --extent', 'Web Mercator Extent')
  .option('-m, --c2m [c2m]', 'Coordinate to Meter')
  .option('-n, --m2c [m2c]', 'Meter to Coordinate')
  .option('-p, --c2p [c2p]', 'Coordinate to Pixel')
  .option('-c, --p2c [p2c]', 'Pixel to Coordinate')
  .parse(process.argv);

if (program.extent) {
  console.log(new Map.Rect(-20037508.34, -20037508.34, 40075016.68, 40075016.68));

} else if (program.c2m && typeof program.c2m !== 'boolean') {
  coordinates = program.c2m.split(/,/);
  if (coordinates.length < 2) return;
   
  map = new Map();
  projectedPoint = map.coordinateToProjectedPoint(new Map.Coordinate(coordinates[0], coordinates[1]));
  console.log(projectedPoint);

} else if (program.m2c && typeof program.m2c !== 'boolean') {
  projectedPoints = program.m2c.split(/,/);
  if (projectedPoints.length < 2) return;

  map = new Map();
  coordinate = map.projectedPointToCoordinate(new Map.ProjectedPoint(projectedPoints[0], projectedPoints[1]));
  console.log(coordinate);

} else if (program.c2p && typeof program.c2p !== 'boolean') {
  coordinateZooms = program.c2p.split(/,/);
  if (coordinateZooms.length < 3) return;

  map = new Map();
  map.zoom = coordinateZooms[2];
  pixel = map.coordinateToPixel(new Map.Coordinate(coordinateZooms[0], coordinateZooms[1]));
  console.log(pixel);
} else if (program.p2c && typeof program.p2c !== 'boolean') {
  pixelZooms = program.p2c.split(/,/);
  if (pixelZooms.length < 3) return;

  map = new Map();
  map.zoom = pixelZooms[2];
  coordinate = map.pixelToCoordinate(new Map.Point(pixelZooms[0], pixelZooms[1]));
  console.log(coordinate);
}



//var map = new Map();
//map.zoom = 15;

//var point = map.coordinateToPixel(new Map.Coordinate(35.3, 139.3));
//console.log(point); // Point {x: 7440229.262674059, y: 3314159.882238767}

//var coordinate = map.pixelToCoordinate(point);
//console.log(coordinate); // Coordinate {latitude: 139.3, longitude: 35.29999999999999}
